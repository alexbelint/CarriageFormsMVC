@model IEnumerable<MVC_WebCargoRequestHandler.Models.CargoForm>
<br />

<br />
<div class="container">
    <table class="table table-hover" id="headerTable">
        <thead>
            <tr>
                <th>
                    Дата пост. заявки
                </th>
                <th>
                    Способ связи
                </th>
                <th>
                    Заказчик
                </th>
                <th>
                    Описание груза
                </th>
                <th>
                    ГНГ/ЕТСНГ
                </th>
                <th>
                    Станция отправления
                </th>
                <th>
                    Место назначения
                </th>
                <th>
                    Направление
                </th>
                <th>
                    Тип ПС
                </th>
                <th>
                    Стоимость
                </th>
                <th>
                    Валюта
                </th>
                <th>
                    Вид сообщения
                </th>
                <th>
                    Дата ответа
                </th>
            </tr>
        </thead>
        <tbody id="tbody">
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.ReceiptDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CommunicationMethod.CommunicationName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Customer)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CargoDescription)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CargoCode)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Departure)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Destination)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Direction.DirectionName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.RollingStockType.RollingStockName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Cost)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Currencies.CurrencyName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TrafficClassification.TrafficClassificationName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ResponseDate)
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div>
    <input type="button"  value=".xls" onclick="fnExcelReport();"class="btn btn-success"/>  

    <iframe id="txtArea1" style="display:none"></iframe>

</div>

<script>
    function fnExcelReport() {
        var tab_text = "<table border='2px'>";
        //var tab_text = "<table border='2px'><tr bgcolor='#87AFC6'>";
        var textRange; var j = 0;
        tab = document.getElementById('headerTable'); // id of table

        for (j = 0; j < tab.rows.length; j++) {
            tab_text = tab_text + tab.rows[j].innerHTML + "</tr>";
        }

        tab_text = tab_text + "</table>";
        tab_text = tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // removes input params

        var ua = window.navigator.userAgent;
        //var msie = ua.indexOf("MSIE ");

        //if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
        //{
        //    txtArea1.document.open("txt/html", "replace");
        //    txtArea1.document.write(tab_text);
        //    txtArea1.document.close();
        //    txtArea1.focus();
        //    sa = txtArea1.document.execCommand("SaveAs", true, "Report.xls");
        //}
        if                 //other browser not tested on IE 11
            sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));

        return (sa);
    }
</script>
